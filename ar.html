<html lang="en">
  <head>
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.0.1/dist/aframe-extras.min.js"></script>
    <script src="https://raw.githack.com/jeromeetienne/AR.js/1.7.5/aframe/build/aframe-ar.js"></script>
    <title>KPMG Blue Ocean Gin AR</title>
  </head>
  <body>
    <a-scene
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false; patternRatio: .6;"
    >
      <a-assets>
        <a-asset-item
          id="jellyfish"
          src="https://cdn.glitch.com/11a102fe-5f9b-4e42-bf00-82d227d6f268%2Fjellyfishsolo2.gltf"
        ></a-asset-item>
        <a-asset-item
          id="tuna"
          src="https://cdn.glitch.com/11a102fe-5f9b-4e42-bf00-82d227d6f268%2FtunaFixed.gltf"
        ></a-asset-item>
        <a-asset-item
          id="trout"
          src="https://cdn.glitch.com/11a102fe-5f9b-4e42-bf00-82d227d6f268%2FTroutFinal.gltf"
        ></a-asset-item>
        <a-asset-item
          id="salmon"
          src="https://cdn.glitch.com/11a102fe-5f9b-4e42-bf00-82d227d6f268%2FSalmonFixed.gltf"
        ></a-asset-item>
        <a-asset-item
          id="waves"
          src="https://cdn.glitch.com/11a102fe-5f9b-4e42-bf00-82d227d6f268%2FWavesNew123456798.gltf"
        ></a-asset-item>
        <a-asset-item
          id="ocean-floor"
          src="https://cdn.glitch.com/11a102fe-5f9b-4e42-bf00-82d227d6f268%2FOceanFloorPNG.glb"
        ></a-asset-item>
        <a-asset-item
          id="kelp"
          src="https://cdn.glitch.com/11a102fe-5f9b-4e42-bf00-82d227d6f268%2FKelpFinal.gltf?v=1574718312130"
        ></a-asset-item>
      </a-assets>
      <a-marker-camera
        type="pattern"
        url="./patterns/pattern-Gin.patt"
        emitevents="true"
        registerevents
        >
        <a-entity
          gltf-model="#ocean-floor"
          scale="10 10 10"
          rotation="-90 0 0"
        ></a-entity>
        <a-entity
          gltf-model="#trout"
          scale="0.1 0.1 0.1"
          animation-mixer="clip: *; timeScale: 0.5;"
          rotation="-90 0 0"
        ></a-entity>
        <a-entity
          gltf-model="#tuna"
          scale="0.1 0.1 0.1"
          animation-mixer="clip: *; timeScale: 0.5;"
          rotation="-90 0 0"
        ></a-entity>
        <a-entity
          gltf-model="#salmon"
          scale="0.1 0.1 0.1"
          animation-mixer="clip: *; timeScale: 0.5;"
          rotation="-90 0 0"
        ></a-entity>
        <a-entity
          gltf-model="#jellyfish"
          scale="0.15 0.15 0.15"
          animation-mixer="clip: *; timeScale: 1; loop: pingpong;"
          rotation="-90 0 0"
          jellyanim
        ></a-entity>
        <a-entity
          gltf-model="#kelp"
          scale="0.1 0.1 0.1"
          animation-mixer="clip: *;"
          rotation="-90 0 0"
        ></a-entity>
        <a-entity
          gltf-model="#waves"
          scale="0.1 0.1 0.1"
          animation-mixer="clip: *, timeScale=1;"
          rotation="-90 0 0"
        ></a-entity>
      </a-marker-camera>
      <!-- <a-entity camera></a-entity> -->
    </a-scene>
    <audio id="voice-over">
      <source src="./objects/KPMG_VO.wav" />
    </audio>
    <script>
      var voiceOver = document.getElementById('voice-over')
      AFRAME.registerComponent('jellyanim', {
        init: function() {
          var jelly = this.el

          jelly.addEventListener('animation-loop', function() {
            jelly.components['animation-mixer'].data.timeScale == 1
              ? jelly.setAttribute('animation-mixer', { timeScale: 0.5 })
              : jelly.setAttribute('animation-mixer', { timeScale: 1 })
          })
        },
      })
      AFRAME.registerComponent('registerevents', {
        init: function() {
          var marker = this.el
          marker.addEventListener('markerFound', function() {
            console.log('markerFound oh me oh my')
            voiceOver.play()
          })
          marker.addEventListener('markerLost', function() {
            console.log('markerLost what the dang')
          })
        },
      })
    </script>
  </body>
</html>
